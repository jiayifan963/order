<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹ä¸­ç”Ÿé€±é»é¤ç³»çµ±</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f4f8; padding: 20px; color: #333; }
        .card { background: white; max-width: 450px; margin: 0 auto; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 20px; }
        .section-label { font-weight: bold; margin-bottom: 8px; display: block; color: #555; }
        .day-box { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 12px; border-left: 5px solid #1a73e8; }
        .no-service { border-left: 5px solid #ccc; background: #eee; color: #777; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        .date-tag { font-size: 0.9em; color: #1a73e8; margin-left: 5px; font-weight: normal; }
        select, input[type="text"] { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; box-sizing: border-box; background: white; }
        .custom-name-box { margin-top: 10px; display: none; background: #fffde7; padding: 10px; border-radius: 8px; border: 1px dashed #fbc02d; }
        .total-box { text-align: right; font-size: 1.2em; font-weight: bold; color: #d93025; margin: 20px 0; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; background: #1a73e8; color: white; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #ccc; }
        .week-selector { background: #e7f3ff; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #1a73e8; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“… åœ‹ä¸­ç”Ÿé€±é»é¤</h2>
    
    <div style="margin-bottom: 15px;">
        <span class="section-label">ä½ çš„å§“å</span>
        <select id="studentName" onchange="checkCustomName()">
            <option value="">-- è«‹é¸æ“‡ --</option>
            <option value="å¿—å®‡">å¿—å®‡</option>
            <option value="å­ç¿Š">å­ç¿Š</option>
            <option value="ç´³è±ª">ç´³è±ª</option>
            <option value="éŸ»å®‰">éŸ»å®‰</option>
            <option value="å­è±ª">å­è±ª</option>
            <option value="ç‘€æ¨‚">ç‘€æ¨‚</option>
            <option value="å®£å¦¤">å®£å¦¤</option>
            <option value="æ¬è‘³">æ¬è‘³</option>
            <option value="å»ºå„„">å»ºå„„</option>
            <option value="å¦æ±">å¦æ±</option>
            <option value="æ˜Šè¬™">æ˜Šè¬™</option>
            <option value="æ±éœ–">æ±éœ–</option>
            <option value="CUSTOM">â• æ‰‹å‹•è¼¸å…¥å§“å...</option>
        </select>
        <div id="customNameBox" class="custom-name-box">
            <input type="text" id="customNameInput" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—">
        </div>
    </div>

    <div class="week-selector">
        <span class="section-label">é¸æ“‡è¨‚é¤é€±æ¬¡</span>
        <select id="weekSelect" onchange="setDates()">
            <option value="0">æœ¬é€±</option>
            <option value="1">ä¸‹é€±</option>
            <option value="2">ä¸‹ä¸‹é€±</option>
            <option value="3">ç¬¬å››é€±</option>
        </select>
    </div>

    <div id="orderList">
        <div class="day-box"><label>é€±ä¸€ <span class="date-tag" id="date-mon"></span></label>
            <select class="day-sel" id="mon" onchange="updateTotal()">
                <option value="ä¸è¨‚é¤">ä¸è¨‚é¤</option>
                <option value="é¤ç›’">é¤ç›’ ($70)</option>
            </select>
        </div>
        <div class="day-box no-service"><label>é€±äºŒ <span class="date-tag" id="date-tue"></span></label>
            <select class="day-sel" id="tue" disabled>
                <option value="ä»Šæ—¥ä¸ä¾›é¤">ä»Šæ—¥ä¸ä¾›é¤</option>
            </select>
        </div>
        <div class="day-box"><label>é€±ä¸‰ <span class="date-tag" id="date-wed"></span></label>
            <select class="day-sel" id="wed" onchange="updateTotal()">
                <option value="ä¸è¨‚é¤">ä¸è¨‚é¤</option>
                <option value="ä¹¾é—œæ±ç…®">ä¹¾é—œæ±ç…® ($70)</option>
                <option value="æ¹¯é—œæ±ç…®">æ¹¯é—œæ±ç…® ($70)</option>
                <option value="æ»·è‚‰é£¯">æ»·è‚‰é£¯ ($70)</option>
            </select>
        </div>
        <div class="day-box"><label>é€±å›› <span class="date-tag" id="date-thu"></span></label>
            <select class="day-sel" id="thu" onchange="updateTotal()">
                <option value="ä¸è¨‚é¤">ä¸è¨‚é¤</option>
                <option value="é¤ç›’">é¤ç›’ ($70)</option>
            </select>
        </div>
        <div class="day-box"><label>é€±äº” <span class="date-tag" id="date-fri"></span></label>
            <select class="day-sel" id="fri" onchange="updateTotal()">
                <option value="ä¸è¨‚é¤">ä¸è¨‚é¤</option>
                <option value="é¤ç›’">é¤ç›’ ($70)</option>
            </select>
        </div>
    </div>

    <div class="total-box">è©²é€±ç¸½è¨ˆï¼š$<span id="totalText">0</span></div>
    
    <button class="btn" id="subBtn" onclick="submitData()">ğŸš€ æäº¤è©²é€±è¨‚å–®</button>
</div>

<script>
    const webAppUrl = "https://script.google.com/macros/s/AKfycbzj5oVJVqNH7WEqirF--tWVLxofs6IuYzRQ1r5UG25-EMenJKSdmab-JEumdqEdQCbkkw/exec";

    // è‡ªå‹•è¨ˆç®—æ—¥æœŸ
    function setDates() {
        const now = new Date();
        const weekOffset = parseInt(document.getElementById('weekSelect').value);
        const dayOfWeek = now.getDay(); 
        
        // ç®—å‡ºè©²é€±é€±ä¸€
        // å¦‚æœæ˜¯é€±æ—¥(0)ï¼Œç®—ä½œæœ¬é€±
        const diffToMon = (dayOfWeek === 0 ? 1 : 1 - dayOfWeek) + (weekOffset * 7);
        const baseDate = new Date(now);
        baseDate.setDate(now.getDate() + diffToMon);

        const ids = ['mon', 'tue', 'wed', 'thu', 'fri'];
        ids.forEach((id, index) => {
            const targetDate = new Date(baseDate);
            targetDate.setDate(baseDate.getDate() + index);
            const m = targetDate.getMonth() + 1;
            const d = targetDate.getDate();
            document.getElementById('date-' + id).innerText = `(${m}/${d})`;
        });
    }

    // åˆå§‹åŒ–æ—¥æœŸ
    setDates();

    function checkCustomName() {
        const sel = document.getElementById('studentName');
        const box = document.getElementById('customNameBox');
        box.style.display = (sel.value === "CUSTOM") ? "block" : "none";
    }

    function updateTotal() {
        let total = 0;
        const selects = document.querySelectorAll('.day-sel');
        selects.forEach(sel => {
            if (sel.value !== "ä¸è¨‚é¤" && sel.value !== "ä»Šæ—¥ä¸ä¾›é¤") {
                total += 70;
            }
        });
        document.getElementById('totalText').innerText = total;
    }

    function submitData() {
        let finalName = document.getElementById('studentName').value;
        if (finalName === "CUSTOM") finalName = document.getElementById('customNameInput').value.trim();
        if (!finalName) return alert("è«‹é¸æ“‡æˆ–è¼¸å…¥å§“åï¼");

        const weekLabel = document.getElementById('weekSelect').options[document.getElementById('weekSelect').selectedIndex].text;
        
        const btn = document.getElementById('subBtn');
        btn.disabled = true;
        btn.innerText = "å‚³é€ä¸­...";

        const params = new URLSearchParams({
            name: finalName,
            week: weekLabel, // å‚³é€æ˜¯å“ªä¸€é€± (æœ¬é€±/ä¸‹é€±...)
            mon: document.getElementById('mon').value,
            tue: document.getElementById('tue').value,
            wed: document.getElementById('wed').value,
            thu: document.getElementById('thu').value,
            fri: document.getElementById('fri').value,
            total: document.getElementById('totalText').innerText
        });

        fetch(webAppUrl + "?" + params.toString(), { mode: 'no-cors' })
        .then(() => {
            alert("âœ… " + finalName + "ï¼Œ" + weekLabel + "é»é¤æˆåŠŸï¼");
            location.reload();
        })
        .catch(err => {
            alert("å¤±æ•—ï¼è«‹æª¢æŸ¥ç¶²è·¯");
            btn.disabled = false;
        });
    }
</script>

</body>
</html>
